import{a as T,o as e}from"./chunk-IR6S3I6Y-DmKRdMYR.js";import{A as M}from"./avatar-BJvGI2je.js";import{u as P,D as L,a as E,b as O,d as A,e as z,f as q,C as K,g as N,T as Q,h as W}from"./thread.schema-DDD88C0L.js";import{u as Z,t as D,B as R,P as $}from"./QueryClientProvider-Y79vg6s4.js";import{u as H,a as V,i as Y,I as U}from"./api-C3WgiByt.js";import{u as _}from"./authStore-BusQRGVs.js";import{u as G,s as J,F as B,a as X}from"./zod-CxjU56v7.js";import{B as f}from"./box-Dg76m1IB.js";import{I as ee}from"./input-coGY6x29.js";import{T as te}from"./text-DPDxdRnU.js";const he="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16.44%203.09998C14.63%203.09998%2013.01%203.97998%2012%205.32998C10.99%203.97998%209.37%203.09998%207.56%203.09998C4.49%203.09998%202%205.59998%202%208.68998C2%209.87998%202.19%2010.98%202.52%2012C4.1%2017%208.97%2019.99%2011.38%2020.81C11.72%2020.93%2012.28%2020.93%2012.62%2020.81C15.03%2019.99%2019.9%2017%2021.48%2012C21.81%2010.98%2022%209.87998%2022%208.68998C22%205.59998%2019.51%203.09998%2016.44%203.09998Z'%20fill='%23D71913'/%3e%3c/svg%3e",me="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12.62%2020.81C12.28%2020.93%2011.72%2020.93%2011.38%2020.81C8.48%2019.82%202%2015.69%202%208.68998C2%205.59998%204.49%203.09998%207.56%203.09998C9.38%203.09998%2010.99%203.97998%2012%205.33998C13.01%203.97998%2014.63%203.09998%2016.44%203.09998C19.51%203.09998%2022%205.59998%2022%208.68998C22%2015.69%2015.52%2019.82%2012.62%2020.81Z'%20stroke='%23909090'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",fe=u=>{const o=new Date(u),c=new Date().getTime()-o.getTime(),d=Math.floor(c/1e3),r=Math.floor(d/60),s=Math.floor(r/60),n=Math.floor(s/24),a=Math.floor(n/30),g=Math.floor(a/12);return d<60?d+" seconds ago":r<60?r+" minutes ago":s<24?s+" hours ago":n<30?n+" days ago":a<12?a+" months ago":g+" years ago"};function se(u){var h,m;const{user:o}=_(),l=(h=o==null?void 0:o.profile)==null?void 0:h.fullName,c=(m=o==null?void 0:o.profile)==null?void 0:m.avatarUrl,[d,r]=T.useState(null),s=T.useRef(null),{register:n,handleSubmit:a,formState:{errors:g},reset:p}=G({mode:"onChange",resolver:J(P)}),{ref:w,onChange:j,...y}=n("images"),x=Z();function v(){var t;(t=s==null?void 0:s.current)==null||t.click()}const{isPending:b,mutateAsync:k}=H({mutationKey:["update-thread"],mutationFn:async t=>{const i=new FormData;return i.append("content",t.content),t.images&&i.append("images",t.images[0]),console.log("images",t.images),(await V.post(`/threads/${t.threadId}`,i)).data},onError:t=>{var i;if(Y(t))return D.create({title:(i=t.response)==null?void 0:i.data.errors[0].message,type:"error"});D.create({title:"Something went wrong!",type:"error"})},onSuccess:async t=>{await x.invalidateQueries({queryKey:["threads"]}),await x.invalidateQueries({queryKey:[`threads/${t.data.id}`]}),D.create({title:t.message,type:"success",description:"update Success"}),u(!1)}});async function S(t){await k(t),C()}function C(){p(),r("")}function I(t){if(t.target.files){const i=t.target.files[0],F=URL.createObjectURL(i);r(F)}}return{fullName:l,avatarUrl:c,previewURL:d,setPreviewURL:r,inputFileRef:s,register:n,handleSubmit:a,errors:g,registerImagesRef:w,registerImagesOnChange:j,restRegisterImages:y,isPending:b,onSubmit:S,onClickFile:v,handlePreview:I,clearForm:C}}const pe=u=>{var h,m;const[o,l]=T.useState(!1),{thread:c}=u,{fullName:d,avatarUrl:r,previewURL:s,inputFileRef:n,register:a,handleSubmit:g,errors:p,registerImagesRef:w,registerImagesOnChange:j,restRegisterImages:y,isPending:x,onSubmit:v,onClickFile:b,handlePreview:k,clearForm:S}=se(l),C=()=>{S(),l(!0)},I=()=>{l(!1)};return e.jsxs(L,{lazyMount:!0,size:"sm",open:o,onOpenChange:t=>l(t.open),children:[e.jsx(E,{asChild:!0,children:e.jsx(R,{rounded:"4xl",variant:"outline",color:"fg.success",onClick:C,children:"Edit"})}),e.jsxs($,{children:[e.jsx(O,{}),e.jsx(A,{children:e.jsxs(z,{bg:"bgSite.solid",children:[e.jsx(q,{asChild:!0,children:e.jsx(f,{display:"flex",justifyContent:"end",px:"3",pt:"2",children:e.jsx(K,{size:"2xs",variant:"ghost",justifyContent:"center",justifySelf:"end",rounded:"full",border:"1px solid #fff",color:"white",onClick:I})})}),e.jsx(N,{children:e.jsx("form",{onSubmit:g(v),children:e.jsxs(f,{display:"flex",flexDirection:"column",padding:"0px 0px",spaceY:2,children:[e.jsxs(f,{display:"flex",alignItems:"center",gap:"4",py:"2",borderBottom:"1px solid",borderColor:"white",children:[e.jsx(M,{name:d||"",src:r||"",shape:"full",size:"full",width:"50px",height:"50px"}),e.jsxs(B,{invalid:!!((h=p.content)!=null&&h.message),children:[e.jsx(Q,{color:"white",border:"none",defaultValue:c.content,placeholder:"What is happening?!",...a("content")}),e.jsx(X,{children:(m=p.content)==null?void 0:m.message})]}),e.jsx(B,{children:e.jsx("input",{type:"text",hidden:!0,value:c.id,...a("threadId")})})]}),e.jsxs(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(R,{variant:"ghost",onClick:b,_hover:{bg:"initial"},children:e.jsx(U,{src:W,width:"27px"})}),e.jsx(ee,{type:"file",hidden:!0,...y,onChange:t=>{k(t),j(t)},ref:t=>{w(t),n.current=t}}),e.jsx(R,{type:"submit",backgroundColor:"brand.solid",color:"white",w:"1/5",h:"8",rounded:"4xl",loading:!!x,children:e.jsx(te,{color:"white",fontSize:"xs",children:"Post"})})]}),e.jsx(f,{w:"full",display:"flex",justifyContent:"start",children:e.jsx(U,{rounded:"3xl",objectFit:"contain",maxHeight:"200px",maxWidth:"100%",src:s===""?c.images:s??""})})]})})})]})})]})]})};export{pe as U,me as a,fe as g,he as l};
