import{w as D}from"./with-props-BMy_yGDR.js";import{o as e,x as F,v as N}from"./chunk-IR6S3I6Y-DmKRdMYR.js";import{A as L,u as q}from"./avatar-BJvGI2je.js";import{g as A,l as B,a as K,U as $}from"./update-thread-dialog-KHqC5pOF.js";import{B as i}from"./box-Dg76m1IB.js";import{T as a}from"./text-DPDxdRnU.js";import{u as P,B as w,t as x,l as z}from"./QueryClientProvider-Y79vg6s4.js";import{u as b,I as C,a as k,i as I}from"./api-C3WgiByt.js";import{u as U}from"./authStore-BusQRGVs.js";import{S as E}from"./show-BT0EsfZw.js";import{H as R}from"./h-stack-CzZcGfDb.js";import{z as T,u as Q,F as W,a as H,s as Y}from"./zod-CxjU56v7.js";import{T as _}from"./thread.schema-DDD88C0L.js";import{a as M}from"./arrow-left-BD1zmGzF.js";import"./query-CfEU5IWo.js";import"./create-recipe-context-GxxJYqGB.js";import"./input-coGY6x29.js";import"./index-BfRFUK5P.js";import"./js.cookie-Cz0CWeBA.js";import"./field.anatomy-BYGrjU18.js";import"./icon-button-c1iJnyvC.js";import"./render-strategy-a8E6jqFR.js";function O(t){var r,n,o,c,d,p,u;return console.log("this is reply",t),e.jsxs(i,{display:"flex",gap:"16px",borderBlock:"1px solid",borderColor:"bdr",py:"5",px:"10",children:[e.jsx(L,{name:((n=(r=t.user)==null?void 0:r.profile)==null?void 0:n.fullName)||"",src:((c=(o=t.user)==null?void 0:o.profile)==null?void 0:c.avatarUrl)||"",shape:"full",size:"full",width:"50px",height:"50px"}),e.jsxs(i,{display:"flex",flexDirection:"column",gap:"4px",children:[e.jsxs(i,{display:"flex",gap:"4px",children:[e.jsx(a,{fontWeight:"bold",color:"white",children:(p=(d=t.user)==null?void 0:d.profile)==null?void 0:p.fullName}),e.jsxs(a,{color:"text.light",children:["@",(u=t.user)==null?void 0:u.username]}),e.jsx(a,{color:"text.light",children:"•"}),e.jsx(a,{color:"text.light",children:A(t.createdAt)})]}),e.jsx(a,{color:"white",children:t.content})]})]})}function G(t){var y,j,m,h,f,g;const{user:r}=U(),{threadId:n}=F(),o=P();console.log((y=t.user)==null?void 0:y.profile.fullName);const{isPending:c,mutateAsync:d}=b({mutationKey:["like"],mutationFn:async s=>(await k.post("/likes",s)).data,onError:s=>{var l;if(I(s))return x.create({title:(l=s.response)==null?void 0:l.data.message,type:"error"});x.create({title:"Something went wrong!",type:"error"})},onSuccess:async()=>{await o.invalidateQueries({queryKey:[`threads/${n}`]})}}),{isPending:p,mutateAsync:u}=b({mutationKey:["unlike"],mutationFn:async s=>(await k.delete(`/likes/${s.threadId}`)).data,onError:s=>{var l;if(I(s))return x.create({title:(l=s.response)==null?void 0:l.data.message,type:"error"});x.create({title:"Something went wrong!",type:"error"})},onSuccess:async()=>{await o.invalidateQueries({queryKey:[`threads/${n}`]})}});async function S(s){await d(s)}async function v(s){await u(s)}return e.jsx(i,{children:e.jsxs(i,{display:"flex",gap:"16px",px:"40px",py:"20px",w:"full",children:[e.jsx(L,{name:((j=t.user)==null?void 0:j.profile.fullName)||"",src:((m=t.user)==null?void 0:m.profile.avatarUrl)??"",shape:"full",size:"full",width:"50px",height:"50px"}),e.jsxs(i,{display:"flex",flexDirection:"column",gap:"4px",flex:"3",children:[e.jsxs(i,{display:"flex",gap:"4px",alignItems:"center",children:[e.jsx(a,{fontWeight:"bold",textStyle:"md",color:"white",children:(h=t.user)==null?void 0:h.profile.fullName}),e.jsxs(a,{textStyle:"sm",color:"text.light",children:["@",(f=t.user)==null?void 0:f.username]}),e.jsx(a,{color:"white",children:"•"}),e.jsx(a,{color:"white",textStyle:"sm",children:A(t.createdAt)})]}),e.jsxs(i,{w:"full",flexDir:"column",justifyContent:"center",alignItems:"start",display:"flex",spaceY:5,children:[e.jsx(a,{cursor:"pointer",color:"white",children:t.content}),e.jsx(C,{src:t.images,rounded:"4xl",maxH:"300px",maxW:"75%"})]}),e.jsxs(i,{display:"flex",children:[e.jsxs(w,{variant:"ghost",display:"flex",gap:"4px",_hover:{bg:"initial"},disabled:c||p,onClick:()=>t.isLiked?v({threadId:t.id}):S({threadId:t.id}),children:[e.jsx(C,{src:t.isLiked?B:K,width:"27px"}),e.jsx(a,{color:"white",children:t.likesCount})]}),e.jsx(w,{variant:"ghost",display:"flex",_hover:{bg:"initial"},gap:"4px"})]})]}),e.jsx(E,{when:((g=t.user)==null?void 0:g.id)===(r==null?void 0:r.id),children:e.jsx(R,{justifySelf:"flex-start",alignItems:"start",zIndex:"docked",children:e.jsx($,{thread:t})})})]})})}const J=T.object({content:T.string().max(280)});function V(){var m,h,f,g;const{threadId:t}=F(),{user:r}=U(),n=(m=r==null?void 0:r.profile)==null?void 0:m.fullName,o=(h=r==null?void 0:r.profile)==null?void 0:h.avatarUrl,{register:c,handleSubmit:d,formState:{errors:p},reset:u}=Q({mode:"onChange",resolver:Y(J)}),S=P(),{isPending:v,mutateAsync:y}=b({mutationKey:["create-reply"],mutationFn:async s=>(await k.post(`/replies/${t}`,s)).data,onError:s=>{var l;if(I(s))return x.create({title:(l=s.response)==null?void 0:l.data.message,type:"error"});x.create({title:"Something went wrong!",type:"error"})},onSuccess:async s=>{await S.invalidateQueries({queryKey:[`threads/${t}`]}),x.create({title:s.message,type:"success"})}});async function j(s){await y(s),u()}return e.jsx("form",{onSubmit:d(j),children:e.jsx(i,{display:"flex",flexDirection:"column",padding:"20px 0px",spaceY:"2",children:e.jsxs(i,{display:"flex",alignItems:"center",gap:"20px",children:[e.jsx(L,{name:n||"",src:o||"",shape:"full",size:"full",width:"50px",height:"50px"}),e.jsxs(W,{invalid:!!((f=p.content)!=null&&f.message),children:[e.jsx(_,{color:"white",placeholder:"What is happening?!",...c("content")}),e.jsx(H,{children:(g=p.content)==null?void 0:g.message})]}),e.jsx(w,{type:"submit",backgroundColor:"brand.solid",color:"white",rounded:"2xl",loading:!!v,children:"Post"})]})})})}function X(t){var c;const{threadId:r}=t;console.log(r);const{data:n,isLoading:o}=q({queryKey:[`threads/${r}`],queryFn:async()=>(await k.get(`threads/${r}`)).data});return e.jsx(i,{children:o?e.jsx(i,{display:"flex",justifyContent:"center",py:50,children:e.jsx(z,{})}):e.jsx(e.Fragment,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(i,{borderBottom:"1px solid",borderColor:"bdr",children:e.jsx(G,{...n})}),e.jsx(i,{px:"10",children:e.jsx(V,{})}),(c=n==null?void 0:n.replies)==null?void 0:c.map(d=>e.jsx(O,{...d}))]})})})}const ke=D(function(){const r=N();function n(){r("/")}const{threadId:o}=F();return e.jsxs(i,{children:[e.jsxs(i,{display:"flex",gap:"10px",children:[e.jsx(w,{onClick:n,variant:"ghost",display:"flex",gap:"4px",color:"secondary",children:e.jsx(C,{src:M,width:"27px"})}),e.jsx(a,{fontSize:"2xl",children:"Status"})]}),o&&e.jsx(e.Fragment,{children:e.jsx(X,{threadId:o})})]})});export{ke as default};
