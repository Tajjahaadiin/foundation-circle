import{a as w,o as e,y as M}from"./chunk-IR6S3I6Y-DmKRdMYR.js";import{D as V,a as X,b as J,d as Y,e as Z,i as $,j as ee,f as re,C as se,g as ie,h as _}from"./thread.schema-DDD88C0L.js";import{A as ne}from"./avatar-BJvGI2je.js";import{f as z}from"./theme-CI7rxUqC.js";import{u as G}from"./authStore-BusQRGVs.js";import{u as te,t as q,B as y,P as ae}from"./QueryClientProvider-Y79vg6s4.js";import{u as le,a as oe,i as de,I as E}from"./api-C3WgiByt.js";import{z as t,u as ce,s as ue,F as O,b as W,c as T,a as H}from"./zod-CxjU56v7.js";import{F as K}from"./flex-BUJ8Rvdc.js";import{B as u}from"./box-Dg76m1IB.js";import{F as Q}from"./float-Dj78ZGsy.js";import{I as f}from"./input-coGY6x29.js";const fe=t.object({fullName:t.string().min(4).max(100),username:t.string().min(4).max(12),bio:t.string().min(5).max(60),bannerUrl:t.preprocess(r=>typeof FileList<"u"&&r instanceof FileList?Array.from(r):[],t.array(t.instanceof(File)).optional()),avatarUrl:t.preprocess(r=>typeof FileList<"u"&&r instanceof FileList?Array.from(r):[],t.array(t.instanceof(File)).optional())});function me(){const{user:r}=G(),a=te(),m=w.useRef(null),p=w.useRef(null),[v,o]=w.useState(null),[C,g]=w.useState(null),{register:d,handleSubmit:B,formState:{errors:F},reset:R}=ce({mode:"onChange",defaultValues:{fullName:(r==null?void 0:r.profile.fullName)??"",username:(r==null?void 0:r.username)??"",bio:(r==null?void 0:r.profile.bio)??""},resolver:ue(fe)}),{ref:U,onChange:S,...P}=d("avatarUrl"),{ref:D,onChange:L,...N}=d("bannerUrl"),{isPending:A,mutateAsync:k}=le({mutationKey:["update-profile"],mutationFn:async s=>{const i=new FormData;return i.append("fullName",s.fullName),i.append("username",s.username.toLowerCase()),i.append("bio",s.bio),s.avatarUrl&&i.append("avatarUrl",(r==null?void 0:r.profile.avatarUrl)??""),s.bannerUrl&&i.append("bannerUrl",(r==null?void 0:r.profile.bannerUrl)??""),console.log("formData",i),(await oe.post("/profile",i)).data},onError:s=>{var i;if(console.log(s),de(s))return q.create({title:s.message,description:(i=s.response)==null?void 0:i.data.message,type:"error",duration:5e3});q.create({title:"Something went wrong!",type:"error"})},onSuccess:async s=>{q.create({title:s.message,type:"success"}),await a.invalidateQueries({queryKey:["threads"]}),await a.invalidateQueries({queryKey:["check-auth"]}),c(),window.location.pathname="/"}}),I=async s=>{await k(s)},x=()=>{var s;(s=m.current)==null||s.click()},h=()=>{var s;(s=p.current)==null||s.click()};function j(s){if(s.target.files){const i=s.target.files[0],l=URL.createObjectURL(i);g(l)}}function b(s){if(s.target.files){const i=s.target.files[0],l=URL.createObjectURL(i);console.log("urlbanner",l),o(l)}}function c(){R(),g(""),o("")}return{register:d,previewURL:C,previewBanner:v,handleSubmit:B,errors:F,onSubmit:I,isPending:A,handlePreview:j,handleGalleryAddClick:x,registerImagesRef:U,restRegisterImages:P,registerImagesOnChange:S,inputFileRef:m,handleBannerPreview:b,handleBannerAddClick:h,registerBannerref:D,restRegisterBanner:N,registerBannerOnChange:L,inputBannerRef:p,clearForm:c}}const Re=()=>{var x,h,j,b,c,s,i,l;const{user:r}=G(),{errors:a,handleSubmit:m,isPending:p,onSubmit:v,register:o,registerImagesRef:C,restRegisterImages:g,registerImagesOnChange:d,previewURL:B,handlePreview:F,handleGalleryAddClick:R,inputFileRef:U,handleBannerAddClick:S,handleBannerPreview:P,inputBannerRef:D,previewBanner:L,registerBannerOnChange:N,registerBannerref:A,restRegisterBanner:k,clearForm:I}=me();return e.jsxs(V,{size:"xs",children:[e.jsx(X,{asChild:!0,children:e.jsx(y,{color:"white",variant:"outline",size:"xs",flexBasis:"20",colorPalette:"green",border:"1px solid",_hover:{color:"white",bg:"brand.solid"},rounded:"4xl",justifySelf:"flex-end",children:"edit profile"})}),e.jsxs(ae,{children:[e.jsx(J,{}),e.jsx(Y,{children:e.jsxs(Z,{bg:"bgSite.solid",children:[e.jsxs($,{p:"5px 12px",display:"flex",justifyContent:"space-between",flexDir:"row",children:[e.jsx(ee,{color:"white",children:"Edit Profile"}),e.jsx(re,{asChild:!0,children:e.jsx(se,{size:"2xs",color:"white",border:"1px solid white",rounded:"full",onClick:I})})]}),e.jsx(ie,{children:e.jsxs(M,{onSubmit:m(v),children:[e.jsx(K,{flexDir:"column",children:e.jsxs(u,{position:"relative",h:"12vh",w:"full",alignSelf:"center",rounded:"lg",children:[e.jsx(u,{maxH:"200px",children:e.jsx(E,{objectFit:"cover",maxH:"80px",w:"full",rounded:"lg",src:L??(r==null?void 0:r.profile.bannerUrl)??""})}),e.jsx(Q,{placement:"middle-center",children:e.jsx(y,{size:"xs",variant:"ghost",onClick:S,_hover:{bg:"initial"},children:e.jsx(E,{maxW:"300%",src:_,bg:"bgSite.solid",rounded:"full",p:"0.5"})})}),e.jsxs(Q,{placement:"bottom-start",offsetX:"10",children:[e.jsx(ne,{name:((x=r==null?void 0:r.profile)==null?void 0:x.fullName)??"",src:B??((h=r==null?void 0:r.profile)==null?void 0:h.avatarUrl)??"",size:"2xl"}),e.jsx(Q,{placement:"middle-center",children:e.jsx(y,{size:"xs",variant:"ghost",onClick:R,_hover:{bg:"initial"},children:e.jsx(E,{maxW:"300%",src:_,bg:"bgSite.solid",rounded:"full",p:"0.5"})})})]})]})}),e.jsxs(K,{flexDir:"column",gap:"4",w:"full",mt:10,children:[e.jsxs(O,{invalid:!!((j=a.fullName)!=null&&j.message),required:!0,children:[e.jsxs(u,{pos:"relative",w:"full",children:[e.jsx(f,{className:"peer",placeholder:"",type:"text",rounded:"lg",borderWidth:"2px",borderColor:"#545454",color:"white",...o("fullName")}),e.jsxs(W,{css:z,color:"text.light",children:["Full Name ",e.jsx(T,{})]})]}),e.jsx(H,{children:(b=a.fullName)==null?void 0:b.message})]}),e.jsx(f,{type:"file",hidden:!0,...g,onChange:n=>{F(n),d(n)},ref:n=>{C(n),U.current=n}}),e.jsx(f,{type:"file",hidden:!0,...k,onChange:n=>{P(n),N(n)},ref:n=>{A(n),D.current=n}}),e.jsxs(O,{invalid:!!((c=a.username)!=null&&c.message),required:!0,children:[e.jsxs(u,{pos:"relative",w:"full",children:[e.jsx(f,{className:"peer",placeholder:"",type:"text",rounded:"lg",borderWidth:"2px",borderColor:"#545454",color:"white",...o("username")}),e.jsxs(W,{css:z,color:"text.light",children:["username ",e.jsx(T,{})]})]}),e.jsx(H,{children:(s=a.username)==null?void 0:s.message})]}),e.jsxs(O,{invalid:!!((i=a.bio)!=null&&i.message),required:!0,children:[e.jsxs(u,{pos:"relative",w:"full",children:[e.jsx(f,{className:"peer",placeholder:"",type:"text",rounded:"lg",borderWidth:"2px",borderColor:"#545454",color:"white",...o("bio")}),e.jsxs(W,{css:z,color:"text.light",children:["Bio ",e.jsx(T,{})]})]}),e.jsx(H,{children:(l=a.bio)==null?void 0:l.message})]})]}),e.jsx(K,{justifyContent:"flex-end",mt:"2",children:e.jsx(y,{bg:"brand.solid",size:"xs",rounded:"4xl",loading:!!p,type:"submit",children:"Save"})})]})})]})})]})]})};export{Re as U};
