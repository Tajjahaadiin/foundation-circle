import{w as U}from"./with-props-BMy_yGDR.js";import{a as j,o as e}from"./chunk-IR6S3I6Y-DmKRdMYR.js";import{T as k,h as q,c as D}from"./thread.schema-DDD88C0L.js";import{A as H,u as K}from"./avatar-BJvGI2je.js";import{u as Q,B as y,t as m,l as N}from"./QueryClientProvider-Y79vg6s4.js";import{u as O,I as w,a as b,i as W}from"./api-C3WgiByt.js";import{u as Y}from"./authStore-BusQRGVs.js";import{u as z,F as M,a as G,s as J}from"./zod-CxjU56v7.js";import{B as o}from"./box-Dg76m1IB.js";import{I as V}from"./input-coGY6x29.js";import{C as X}from"./card-thread-D9E0Y6eK.js";import{T as C}from"./text-DPDxdRnU.js";import{F as Z}from"./flex-BUJ8Rvdc.js";import"./icon-button-c1iJnyvC.js";import"./create-recipe-context-GxxJYqGB.js";import"./render-strategy-a8E6jqFR.js";import"./field.anatomy-BYGrjU18.js";import"./query-CfEU5IWo.js";import"./index-BfRFUK5P.js";import"./js.cookie-Cz0CWeBA.js";import"./update-thread-dialog-KHqC5pOF.js";import"./h-stack-CzZcGfDb.js";import"./show-BT0EsfZw.js";function _(){var u,x,f,h;const{user:t}=Y(),l=(u=t==null?void 0:t.profile)==null?void 0:u.fullName,c=(x=t==null?void 0:t.profile)==null?void 0:x.avatarUrl,[n,a]=j.useState(null),i=j.useRef(null),{register:p,handleSubmit:v,formState:{errors:d},reset:F}=z({mode:"onChange",resolver:J(D)}),{ref:S,onChange:I,...T}=p("images"),R=Q();function A(){var r;(r=i==null?void 0:i.current)==null||r.click()}const{isPending:B,mutateAsync:E}=O({mutationKey:["create-thread"],mutationFn:async r=>{const s=new FormData;return s.append("content",r.content),r.images&&s.append("images",r.images[0]),(await b.post("/threads",s)).data},onError:r=>{var s;if(W(r))return m.create({title:(s=r.response)==null?void 0:s.data.errors[0].message,type:"error"});m.create({title:"Something went wrong!",type:"error"})},onSuccess:async r=>{await R.invalidateQueries({queryKey:["threads"]}),m.create({title:r.message,type:"success"})}});async function L(r){await E(r),F(),a("")}function P(r){if(r.target.files){const s=r.target.files[0],g=URL.createObjectURL(s);a(g)}}return e.jsx("form",{onSubmit:v(L),children:e.jsxs(o,{display:"flex",flexDirection:"column",padding:"20px 0px",spaceY:2,children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:"20px",children:[e.jsx(H,{name:l||"",src:c||"",shape:"full",size:"full",width:"50px",height:"50px"}),e.jsxs(M,{invalid:!!((f=d.content)!=null&&f.message),children:[e.jsx(k,{color:"white",placeholder:"What is happening?!",...p("content")}),e.jsx(G,{children:(h=d.content)==null?void 0:h.message})]}),e.jsx(y,{variant:"ghost",onClick:A,children:e.jsx(w,{src:q,width:"27px"})}),e.jsx(V,{type:"file",hidden:!0,...T,onChange:r=>{P(r),I(r)},ref:r=>{S(r),i.current=r}}),e.jsx(y,{type:"submit",backgroundColor:"brand.solid",color:"white",rounded:"2xl",loading:!!B,children:"Post"})]}),e.jsx(o,{w:"full",display:"flex",justifyContent:"start",children:e.jsx(w,{objectFit:"contain",maxHeight:"300px",maxWidth:"300px",src:n??""})})]})})}function $(){const{data:t,isLoading:l,isError:c,failureReason:n}=K({queryKey:["threads"],queryFn:async()=>(await b.get("/threads")).data});return e.jsxs(o,{children:[e.jsx(o,{borderBottom:"2px solid",borderColor:"bdr",children:e.jsxs(o,{px:"40px",pt:"20px",children:[e.jsx(C,{color:"white",children:"Home"}),e.jsx(_,{})]})}),c&&e.jsx(C,{color:"red",children:n==null?void 0:n.message}),l?e.jsx(o,{display:"flex",justifyContent:"center",paddingY:50,children:e.jsx(N,{})}):e.jsx(Z,{flexDir:"column",w:"full",children:t==null?void 0:t.map(a=>e.jsx(X,{thread:a,borderBottom:"2px solid",borderColor:"bdr"},a.id))})]})}const ve=U(function(){return e.jsx($,{})});export{ve as default};
